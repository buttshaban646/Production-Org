name: Apex Tests

on:
  push:
    branches:
      - develop

jobs:
  run-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install Salesforce CLI
        uses: forcedotcom/salesforcedx-action@v3
        with:
          version: 'latest'
      - name: Authenticate with Salesforce CLI
        run: |
          sfdx force:auth:jwt:grant --clientid ${{ secrets.SFDC_CLIENT_ID }} --jwtkeyfile ./server.key --username ${{ secrets.SFDC_USERNAME }} --setdefaultdevhubusername
      - name: Run Apex Tests
        run: sfdx force:apex:test:run --resultformat tap --wait 10
